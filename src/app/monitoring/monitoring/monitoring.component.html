<div class="min-h-screen bg-gray-100">
  <!-- Vista de selecci√≥n de dispositivos -->
  <div
    *ngIf="currentView === 'device-selection'"
    class="container mx-auto px-4 py-6"
  >
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">
        üì° Monitoreo en Tiempo Real
      </h1>
      <p class="text-gray-600">
        Selecciona un dispositivo para visualizar sus datos en tiempo real
      </p>

      <!-- Informaci√≥n de autenticaci√≥n -->
      <div class="mt-4" *ngIf="!isAuthenticated()">
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div class="flex items-center gap-2">
            <span class="text-yellow-600">‚ö†Ô∏è</span>
            <span class="text-yellow-800 font-semibold">No autenticado</span>
          </div>
          <p class="text-yellow-700 text-sm mt-1">
            Debes iniciar sesi√≥n para ver tus dispositivos.
          </p>
          <button
            (click)="goToLogin()"
            class="mt-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
          >
            Iniciar Sesi√≥n
          </button>
        </div>
      </div>
    </div>

    <!-- Estado de carga -->
    <div *ngIf="isLoading" class="flex items-center justify-center h-64">
      <div class="text-center">
        <div class="animate-spin text-4xl mb-4">‚è≥</div>
        <p class="text-gray-600">Cargando dispositivos...</p>
      </div>
    </div>

    <!-- Estado de error -->
    <div
      *ngIf="hasError && !isLoading"
      class="flex items-center justify-center h-64"
    >
      <div class="text-center bg-red-50 p-8 rounded-lg border border-red-200">
        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
        <h3 class="text-xl font-semibold text-red-800 mb-2">Error</h3>
        <p class="text-red-600 mb-4">{{ errorMessage }}</p>
        <button
          (click)="loadUserDevices()"
          class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors"
        >
          Reintentar
        </button>
      </div>
    </div>

    <!-- Lista de dispositivos -->
    <div
      *ngIf="!isLoading && !hasError && userDevices.length > 0"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    >
      <div
        *ngFor="let device of userDevices"
        class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer"
        (click)="selectDevice(device)"
        [hidden]="device.device_type_id === 3"
      >
        <div class="p-6">
          <div class="flex items-center gap-3 mb-4">
            <span class="text-3xl">{{
              getDeviceIcon(device.device_type_id)
            }}</span>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">
                {{ device.name }}
              </h3>
              <p class="text-sm text-gray-600">{{ device.description }}</p>
            </div>
          </div>

          <div class="space-y-2 mb-4">
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Tipo ID:</span>
              <span class="font-medium">{{ device.device_type_id }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">MAC:</span>
              <span class="font-mono text-xs">{{ device.mac_address }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Registrado:</span>
              <span>{{ device.created_at | date : "short" }}</span>
            </div>
          </div>

          <!-- Variables disponibles -->
          <div class="mb-4">
            <p class="text-xs text-gray-600 mb-2">Variables disponibles:</p>
            <div class="flex flex-wrap gap-1">
              <span
                *ngFor="
                  let variable of getDeviceVariables(device.device_type_id)
                "
                class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded"
              >
                {{ variable }}
              </span>
            </div>
          </div>

          <button
            class="w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium"
          >
            Monitorear en Tiempo Real
          </button>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay dispositivos -->
    <div
      *ngIf="!isLoading && !hasError && userDevices.length === 0"
      class="text-center py-12"
    >
      <div class="text-6xl mb-4">üì±</div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">
        No hay dispositivos registrados
      </h3>
      <p class="text-gray-600 mb-4">
        Registra tu primer dispositivo para comenzar el monitoreo.
      </p>
      <button
        (click)="router.navigate(['/devices'])"
        class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
      >
        Registrar Dispositivo
      </button>
    </div>
  </div>

  <!-- Vista de selecci√≥n de sensores para dispositivos tipo 2 -->
  <div
    *ngIf="currentView === 'sensor-selection'"
    class="container mx-auto px-4 py-6"
  >
    <!-- Header -->
    <div class="mb-6">
      <button
        (click)="backToDeviceSelection()"
        class="flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors mb-4"
      >
        <span>‚Üê</span>
        <span>Volver a dispositivos</span>
      </button>

      <h1 class="text-3xl font-bold text-gray-800 mb-2">
        üî¨ Seleccionar Sensor
      </h1>
      <p class="text-gray-600">
        Selecciona el sensor espec√≠fico que deseas monitorear del dispositivo
        <span class="font-semibold">{{ selectedDevice?.name }}</span>
      </p>
    </div>

    <!-- Grid de sensores disponibles -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div
        *ngFor="let sensor of availableSensors | keyvalue"
        class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer border-2 border-transparent hover:border-blue-300"
        (click)="selectSensor(sensor.key)"
      >
        <div class="p-6">
          <div class="flex items-center gap-3 mb-4">
            <span class="text-4xl">{{ sensor.value.icon }}</span>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">
                {{ sensor.value.name }}
              </h3>
              <p class="text-sm text-gray-600">
                {{ sensor.value.description }}
              </p>
            </div>
          </div>

          <!-- Variables del sensor -->
          <div class="mb-4">
            <p class="text-xs text-gray-600 mb-2">Variables monitoreadas:</p>
            <div class="flex flex-wrap gap-1">
              <span
                *ngFor="let variable of sensor.value.variables"
                class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded"
              >
                {{ variable }}
              </span>
            </div>
          </div>

          <button
            class="w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium"
          >
            Monitorear {{ sensor.value.name }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista de monitoreo -->
  <div *ngIf="currentView === 'monitoring'" class="flex h-screen">
    <!-- Barra lateral -->
    <aside class="w-80 bg-white shadow-lg p-6 flex flex-col gap-6">
      <!-- Botones de regreso -->
      <div class="flex flex-col gap-2">
        <!-- Regreso a selecci√≥n de sensores (solo para tipo 2) -->
        <button
          *ngIf="selectedDevice?.device_type_id === 2"
          (click)="backToSensorSelection()"
          class="flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors"
        >
          <span>‚Üê</span>
          <span>Volver a sensores</span>
        </button>

        <!-- Regreso a dispositivos -->
        <button
          (click)="backToDeviceSelection()"
          class="flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors"
          [class.mb-4]="selectedDevice?.device_type_id !== 2"
        >
          <span>‚Üê</span>
          <span>Volver a dispositivos</span>
        </button>
      </div>

      <!-- Informaci√≥n del dispositivo -->
      <div class="bg-gray-50 rounded-lg p-4 border" *ngIf="selectedDevice">
        <div class="flex items-center gap-3 mb-3">
          <span class="text-2xl">{{
            getDeviceIcon(selectedDevice.device_type_id)
          }}</span>
          <div>
            <h3 class="font-semibold text-gray-800">
              {{ selectedDevice.name }}
            </h3>
            <p class="text-xs text-gray-600">
              Tipo ID: {{ selectedDevice.device_type_id }}
            </p>
            <!-- Mostrar sensor seleccionado para tipo 2 -->
            <p
              *ngIf="selectedDevice.device_type_id === 2 && selectedSensor"
              class="text-xs text-blue-600 font-semibold"
            >
              Sensor: {{ getSensorName(selectedSensor) }}
            </p>
          </div>
        </div>

        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600">MAC:</span>
            <span class="font-mono text-xs">{{
              selectedDevice.mac_address
            }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Estado WebSocket:</span>
            <span
              class="px-2 py-1 rounded text-xs"
              [class.bg-green-200]="isWebSocketConnected"
              [class.text-green-700]="isWebSocketConnected"
              [class.bg-red-200]="!isWebSocketConnected"
              [class.text-red-700]="!isWebSocketConnected"
            >
              {{ isWebSocketConnected ? "Conectado" : "Desconectado" }}
            </span>
          </div>
        </div>

        <button
          (click)="reconnectWebSocket()"
          class="w-full mt-3 py-2 px-3 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition"
          [disabled]="isWebSocketConnected"
        >
          {{ isWebSocketConnected ? "Conectado" : "Reconectar" }}
        </button>
      </div>

      <!-- Informaci√≥n del sensor para tipo 2 -->
      <div
        class="border-t pt-4"
        *ngIf="selectedDevice?.device_type_id === 2 && selectedSensor"
      >
        <h3 class="text-sm font-semibold text-gray-700 mb-3">
          Informaci√≥n del Sensor
        </h3>

        <div class="bg-gray-50 rounded-lg p-4 border">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-2xl">{{ getSensorIcon(selectedSensor) }}</span>
            <div>
              <h4 class="font-semibold text-gray-800">
                {{ getSensorName(selectedSensor) }}
              </h4>
              <p class="text-xs text-gray-600">
                {{ getSensorDescription(selectedSensor) }}
              </p>
            </div>
          </div>

          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Variables:</span>
              <span class="font-medium text-gray-800">
                {{ getSensorVariables(selectedSensor) }}
              </span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">WebSocket Topic:</span>
              <span class="font-mono text-xs text-blue-600">{{
                selectedSensor
              }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n adicional para tipo 1 -->
      <div class="border-t pt-4" *ngIf="selectedDevice?.device_type_id === 1">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">
          Monitor El√©ctrico
        </h3>
        <div class="bg-gray-50 rounded-lg p-4 border">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-2xl">‚ö°</span>
            <div>
              <h4 class="font-semibold text-gray-800">PZEM-004T</h4>
              <p class="text-xs text-gray-600">Monitor de energ√≠a el√©ctrica</p>
            </div>
          </div>
        </div>
      </div>

      <!-- M√©tricas en tiempo real -->
      <div class="border-t pt-4" *ngIf="selectedDevice && timeData.length > 0">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">
          Valores Actuales
        </h3>

        <!-- M√©tricas para NODO_CONTROL_PZEM (tipo 1) -->
        <div
          class="space-y-2 text-sm"
          *ngIf="selectedDevice?.device_type_id === 1"
        >
          <div class="flex justify-between">
            <span class="text-gray-600">Voltaje:</span>
            <span class="font-mono text-blue-600 font-semibold">
              {{ lastSensorValues.voltage | number : "1.2-2" }} V
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Corriente:</span>
            <span class="font-mono text-red-600 font-semibold">
              {{ lastSensorValues.current | number : "1.2-2" }} A
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Potencia:</span>
            <span class="font-mono text-green-600 font-semibold">
              {{ lastSensorValues.power | number : "1.2-2" }} W
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Energ√≠a:</span>
            <span class="font-mono text-purple-600 font-semibold">
              {{ lastSensorValues.energy | number : "1.2-2" }} kWh
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Frecuencia:</span>
            <span class="font-mono text-indigo-600 font-semibold">
              {{ lastSensorValues.frequency | number : "1.2-2" }} Hz
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Factor Potencia:</span>
            <span class="font-mono text-teal-600 font-semibold">
              {{ lastSensorValues.powerFactor | number : "1.2-2" }}
            </span>
          </div>
        </div>

        <!-- M√©tricas para NODO_CONTROL_IR (tipo 2) -->
        <div class="space-y-3" *ngIf="selectedDevice?.device_type_id === 2">
          <!-- Temperatura -->
          <div class="bg-red-50 rounded-lg p-3 border border-red-200">
            <div class="flex items-center justify-between mb-1">
              <span class="text-gray-600 text-sm flex items-center gap-1">
                üå°Ô∏è Temperatura
              </span>
              <span
                [class]="getTemperatureColor(lastSensorValues.temperature)"
                class="font-bold text-lg"
              >
                {{ lastSensorValues.temperature | number : "1.1-1" }}¬∞C
              </span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div
                class="bg-red-500 h-2 rounded-full transition-all duration-500"
                [style.width.%]="
                  lastSensorValues.temperature > 0
                    ? (lastSensorValues.temperature / 50) * 100
                    : 0
                "
              ></div>
            </div>
          </div>

          <!-- Humedad -->
          <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
            <div class="flex items-center justify-between mb-1">
              <span class="text-gray-600 text-sm flex items-center gap-1">
                üíß Humedad
              </span>
              <span
                [class]="getHumidityColor(lastSensorValues.humidity)"
                class="font-bold text-lg"
              >
                {{ lastSensorValues.humidity | number : "1.1-1" }}%
              </span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div
                class="bg-blue-500 h-2 rounded-full transition-all duration-500"
                [style.width.%]="lastSensorValues.humidity"
              ></div>
            </div>
          </div>

          <!-- Luz -->
          <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
            <div class="flex items-center justify-between mb-1">
              <span class="text-gray-600 text-sm flex items-center gap-1">
                üí° Luminosidad
              </span>
              <span
                [class]="getLightColor(lastSensorValues.light)"
                class="font-bold text-lg"
              >
                {{ lastSensorValues.light | number : "1.0-0" }} lux
              </span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div
                class="bg-yellow-500 h-2 rounded-full transition-all duration-500"
                [style.width.%]="getLightPercentage(lastSensorValues.light)"
              ></div>
            </div>
          </div>

          <!-- Movimiento -->
          <div
            class="rounded-lg p-3 border transition-all duration-300"
            [class.bg-red-50]="lastSensorValues.motion"
            [class.border-red-200]="lastSensorValues.motion"
            [class.bg-green-50]="!lastSensorValues.motion"
            [class.border-green-200]="!lastSensorValues.motion"
          >
            <div class="flex items-center justify-between mb-1">
              <span class="text-gray-600 text-sm flex items-center gap-1">
                üö∂ Movimiento
              </span>
              <span [class]="getMotionColor()" class="font-bold text-sm">
                {{ getMotionStatus() }}
              </span>
            </div>
            <div
              *ngIf="lastSensorValues.motion && lastSensorValues.lastMotionTime"
              class="text-xs text-gray-500 mt-1"
            >
              √öltimo: {{ lastSensorValues.lastMotionTime }}
            </div>
          </div>

          <!-- Resumen de eventos de movimiento -->
          <div
            *ngIf="motionEvents.length > 0"
            class="bg-purple-50 rounded-lg p-3 border border-purple-200"
          >
            <span class="text-gray-600 text-sm flex items-center gap-1 mb-2">
              üìä Eventos recientes
            </span>
            <div class="text-xs text-purple-700">
              {{ motionEvents.length }} detecciones en la sesi√≥n
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- √Årea principal de tarjetas de datos -->
    <main class="flex-1 p-6 bg-gray-50">
      <div class="h-full">
        <!-- Estado de conexi√≥n -->
        <div class="mb-6 flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-800">
              {{ selectedDevice?.name }}
            </h2>
            <p
              class="text-gray-600"
              *ngIf="selectedDevice?.device_type_id === 2 && selectedSensor"
            >
              Monitoreando: {{ getSensorName(selectedSensor) }}
            </p>
          </div>
          <div class="flex items-center gap-3">
            <div
              class="flex items-center gap-2 px-3 py-2 rounded-lg"
              [class.bg-green-100]="isWebSocketConnected"
              [class.bg-red-100]="!isWebSocketConnected"
            >
              <div
                class="w-3 h-3 rounded-full animate-pulse"
                [class.bg-green-500]="isWebSocketConnected"
                [class.bg-red-500]="!isWebSocketConnected"
              ></div>
              <span
                class="text-sm font-medium"
                [class.text-green-700]="isWebSocketConnected"
                [class.text-red-700]="!isWebSocketConnected"
              >
                {{ isWebSocketConnected ? "Conectado" : "Desconectado" }}
              </span>
            </div>
          </div>
        </div>

        <!-- Tarjetas de datos en tiempo real para dispositivos tipo 2 -->
        <div *ngIf="selectedDevice?.device_type_id === 2" class="space-y-6">
          <!-- Tarjeta DHT22 - Temperatura y Humedad -->
          <div
            *ngIf="selectedSensor === 'dht22'"
            class="grid grid-cols-1 lg:grid-cols-2 gap-6"
          >
            <!-- Temperatura -->
            <div
              class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl shadow-lg p-6 border border-red-200"
            >
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="p-3 bg-red-500 rounded-lg text-white text-2xl">
                    üå°Ô∏è
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-gray-800">
                      Temperatura
                    </h3>
                    <p class="text-sm text-gray-600">Sensor DHT22</p>
                  </div>
                </div>
                <div class="text-right">
                  <div
                    class="text-3xl font-bold"
                    [class]="getTemperatureColor(lastSensorValues.temperature)"
                  >
                    {{ lastSensorValues.temperature | number : "1.1-1" }}¬∞C
                  </div>
                  <div class="text-sm text-gray-500">
                    {{ getCurrentTime() }}
                  </div>
                </div>
              </div>

              <!-- Barra de progreso -->
              <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                  <span>0¬∞C</span>
                  <span>Actual</span>
                  <span>50¬∞C</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div
                    class="bg-gradient-to-r from-blue-400 via-green-400 to-red-500 h-3 rounded-full transition-all duration-700 ease-out"
                    [style.width.%]="
                      getTemperaturePercentage(lastSensorValues.temperature)
                    "
                  ></div>
                </div>
              </div>

              <!-- Estad√≠sticas adicionales -->
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">Estado</div>
                  <div
                    class="font-semibold"
                    [class]="getTemperatureColor(lastSensorValues.temperature)"
                  >
                    {{ getTemperatureStatus(lastSensorValues.temperature) }}
                  </div>
                </div>
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">√öltima actualizaci√≥n</div>
                  <div class="font-semibold text-gray-800">Ahora</div>
                </div>
              </div>
            </div>

            <!-- Humedad -->
            <div
              class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl shadow-lg p-6 border border-blue-200"
            >
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="p-3 bg-blue-500 rounded-lg text-white text-2xl">
                    üíß
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-gray-800">Humedad</h3>
                    <p class="text-sm text-gray-600">Sensor DHT22</p>
                  </div>
                </div>
                <div class="text-right">
                  <div
                    class="text-3xl font-bold"
                    [class]="getHumidityColor(lastSensorValues.humidity)"
                  >
                    {{ lastSensorValues.humidity | number : "1.1-1" }}%
                  </div>
                  <div class="text-sm text-gray-500">
                    {{ getCurrentTime() }}
                  </div>
                </div>
              </div>

              <!-- Barra de progreso -->
              <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                  <span>0%</span>
                  <span>Actual</span>
                  <span>100%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div
                    class="bg-gradient-to-r from-yellow-400 via-blue-400 to-blue-600 h-3 rounded-full transition-all duration-700 ease-out"
                    [style.width.%]="lastSensorValues.humidity"
                  ></div>
                </div>
              </div>

              <!-- Estad√≠sticas adicionales -->
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">Estado</div>
                  <div
                    class="font-semibold"
                    [class]="getHumidityColor(lastSensorValues.humidity)"
                  >
                    {{ getHumidityStatus(lastSensorValues.humidity) }}
                  </div>
                </div>
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">Confort</div>
                  <div class="font-semibold text-gray-800">
                    {{
                      getComfortLevel(
                        lastSensorValues.temperature,
                        lastSensorValues.humidity
                      )
                    }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tarjeta Sensor de Luz -->
          <div
            *ngIf="selectedSensor === 'light_sensor'"
            class="max-w-2xl mx-auto"
          >
            <div
              class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl shadow-lg p-6 border border-yellow-200"
            >
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                  <div class="p-3 bg-yellow-500 rounded-lg text-white text-3xl">
                    üí°
                  </div>
                  <div>
                    <h3 class="text-xl font-semibold text-gray-800">
                      Luminosidad
                    </h3>
                    <p class="text-sm text-gray-600">Sensor LDR</p>
                  </div>
                </div>
                <div class="text-right">
                  <div
                    class="text-4xl font-bold"
                    [class]="getLightColor(lastSensorValues.light)"
                  >
                    {{ lastSensorValues.light | number : "1.0-0" }}
                  </div>
                  <div class="text-lg font-medium text-gray-600">lux</div>
                  <div class="text-sm text-gray-500">
                    {{ getCurrentTime() }}
                  </div>
                </div>
              </div>

              <!-- Indicador visual de luz -->
              <div class="mb-6">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                  <span>Oscuro</span>
                  <span>{{ getLightDescription(lastSensorValues.light) }}</span>
                  <span>Muy brillante</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                  <div
                    class="bg-gradient-to-r from-gray-600 via-yellow-400 to-yellow-200 h-4 rounded-full transition-all duration-700 ease-out relative"
                    [style.width.%]="getLightPercentage(lastSensorValues.light)"
                  >
                    <div
                      class="absolute right-0 top-0 w-3 h-4 bg-white rounded-full shadow-lg transform translate-x-1"
                    ></div>
                  </div>
                </div>
              </div>

              <!-- Estad√≠sticas de luz -->
              <div class="grid grid-cols-3 gap-4 text-sm">
                <div class="bg-white bg-opacity-50 rounded-lg p-3 text-center">
                  <div class="text-gray-600">Estado</div>
                  <div
                    class="font-semibold"
                    [class]="getLightColor(lastSensorValues.light)"
                  >
                    {{ getLightStatus(lastSensorValues.light) }}
                  </div>
                </div>
                <div class="bg-white bg-opacity-50 rounded-lg p-3 text-center">
                  <div class="text-gray-600">Intensidad</div>
                  <div class="font-semibold text-gray-800">
                    {{ getLightIntensity(lastSensorValues.light) }}%
                  </div>
                </div>
                <div class="bg-white bg-opacity-50 rounded-lg p-3 text-center">
                  <div class="text-gray-600">Ambiente</div>
                  <div class="font-semibold text-gray-800">
                    {{ getLightEnvironment(lastSensorValues.light) }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tarjeta Sensor PIR -->
          <div *ngIf="selectedSensor === 'pir'" class="max-w-2xl mx-auto">
            <div
              class="rounded-xl shadow-lg p-6 border transition-all duration-500"
              [class.bg-gradient-to-br]="true"
              [class.from-red-50]="lastSensorValues.motion"
              [class.to-pink-50]="lastSensorValues.motion"
              [class.border-red-200]="lastSensorValues.motion"
              [class.from-green-50]="!lastSensorValues.motion"
              [class.to-emerald-50]="!lastSensorValues.motion"
              [class.border-green-200]="!lastSensorValues.motion"
            >
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                  <div
                    class="p-3 rounded-lg text-white text-3xl transition-all duration-300"
                    [class.bg-red-500]="lastSensorValues.motion"
                    [class.bg-green-500]="!lastSensorValues.motion"
                    [class.animate-pulse]="lastSensorValues.motion"
                  >
                    {{ lastSensorValues.motion ? "üö®" : "ÔøΩ" }}
                  </div>
                  <div>
                    <h3 class="text-xl font-semibold text-gray-800">
                      Detector de Movimiento
                    </h3>
                    <p class="text-sm text-gray-600">Sensor PIR</p>
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-bold" [class]="getMotionColor()">
                    {{ getMotionStatus() }}
                  </div>
                  <div class="text-sm text-gray-500">
                    {{ getCurrentTime() }}
                  </div>
                </div>
              </div>

              <!-- Estado visual del movimiento -->
              <div class="mb-6">
                <div
                  class="w-full h-20 rounded-lg border-2 border-dashed transition-all duration-300 flex items-center justify-center"
                  [class.border-red-300]="lastSensorValues.motion"
                  [class.bg-red-100]="lastSensorValues.motion"
                  [class.border-green-300]="!lastSensorValues.motion"
                  [class.bg-green-100]="!lastSensorValues.motion"
                >
                  <div
                    class="text-4xl transition-all duration-300"
                    [class.animate-bounce]="lastSensorValues.motion"
                  >
                    {{ lastSensorValues.motion ? "üë§" : "üè†" }}
                  </div>
                </div>
              </div>

              <!-- Estad√≠sticas de movimiento -->
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">Estado actual</div>
                  <div class="font-semibold" [class]="getMotionColor()">
                    {{
                      lastSensorValues.motion ? "DETECTADO" : "SIN MOVIMIENTO"
                    }}
                  </div>
                </div>
                <div class="bg-white bg-opacity-50 rounded-lg p-3">
                  <div class="text-gray-600">√öltima detecci√≥n</div>
                  <div class="font-semibold text-gray-800">
                    {{ lastSensorValues.lastMotionTime || "Nunca" }}
                  </div>
                </div>
              </div>

              <!-- Historial de eventos -->
              <div *ngIf="motionEvents.length > 0" class="mt-4">
                <div class="text-sm text-gray-600 mb-2">Eventos recientes:</div>
                <div
                  class="bg-white bg-opacity-50 rounded-lg p-3 max-h-24 overflow-y-auto"
                >
                  <div
                    *ngFor="let event of motionEvents.slice(-5)"
                    class="text-xs text-gray-700 mb-1"
                  >
                    üïê {{ event.time }} - Movimiento detectado
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tarjetas para dispositivos tipo 1 (PZEM) -->
        <div
          *ngIf="selectedDevice?.device_type_id === 1"
          class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"
        >
          <!-- Aqu√≠ mantenemos las tarjetas existentes para dispositivos el√©ctricos -->
          <div
            class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-lg p-6 border border-blue-200"
          >
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="p-3 bg-blue-500 rounded-lg text-white text-2xl">
                  ‚ö°
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-gray-800">Voltaje</h3>
                  <p class="text-sm text-gray-600">PZEM-004T</p>
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-blue-600">
                  {{ lastSensorValues.voltage | number : "1.2-2" }}
                </div>
                <div class="text-lg font-medium text-gray-600">V</div>
              </div>
            </div>
          </div>
          <!-- M√°s tarjetas para otros valores el√©ctricos... -->
        </div>

        <!-- Estado sin datos -->
        <div
          *ngIf="!isWebSocketConnected && timeData.length === 0"
          class="h-96 flex items-center justify-center"
        >
          <div class="text-center">
            <div class="text-6xl mb-4">üì°</div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">
              Esperando datos...
            </h3>
            <p class="text-gray-600 mb-4">
              Conecta el WebSocket para comenzar a recibir datos en tiempo real.
            </p>
            <div class="text-sm text-gray-500">
              <p>
                Dispositivo:
                <span class="font-semibold">{{ selectedDevice?.name }}</span>
              </p>
              <p>
                Sensor:
                <span class="font-semibold">{{
                  getSensorName(selectedSensor || "")
                }}</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
